!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.VueAutosuggest=e.VueAutosuggest||{})}(this,function(e){"use strict";function t(e,t){return!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function n(e,n){t(e,n)||(e.className+=" "+n)}function i(e,t){e.classList&&e.classList.remove(t)}function s(e,t){for(var n=t.parentNode;null!=n;){if(n==e)return!0;n=n.parentNode}return!1}var u={name:"default-section",props:{section:{type:Object,required:!0},currentIndex:{type:Number,required:!1,default:1/0},updateCurrentIndex:{type:Function,required:!0},searchInput:{type:String,required:!1,default:""},renderSuggestion:{type:Function,required:!0},normalizeItemFunction:{type:Function,required:!0}},computed:{list:function(){var e=this.section,t=e.limit,n=e.data;return n.length<t&&(t=n.length),n.slice(0,t)},className:function(){return"autosuggest__results_title autosuggest__results_title_"+this.section.name}},methods:{getItemIndex:function(e){return this.section.start_index+e},getItemByIndex:function(e){return this.section.data[e]},getLabelByIndex:function(e){return this.section.data[e]},onMouseEnter:function(e){this.updateCurrentIndex(e.currentTarget.getAttribute("data-suggestion-index"))},onMouseLeave:function(){this.updateCurrentIndex(null)}},render:function(e){var t=this,n=this.section.label?e("li",{class:this.className},this.section.label):"";return e("ul",{attrs:{role:"listbox","aria-labelledby":"autosuggest"}},[n,this.list.map(function(n,i){var s=t.normalizeItemFunction(t.section.name,t.section.type,t.getLabelByIndex(i),n);return e("li",{attrs:{role:"option","data-suggestion-index":t.getItemIndex(i),"data-section-name":t.section.name,id:"autosuggest__results_item-"+t.getItemIndex(i)},key:t.getItemIndex(i),class:{"autosuggest__results_item-highlighted":t.getItemIndex(i)==t.currentIndex,autosuggest__results_item:!0},on:{mouseenter:t.onMouseEnter,mouseleave:t.onMouseLeave}},[t.renderSuggestion(s)])})])}},r={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:e.component_attr_id_autosuggest}},[n("input",e._b({directives:[{name:"model",rawName:"v-model",value:e.searchInput,expression:"searchInput"}],staticClass:"form-control",class:[e.isOpen?"autosuggest__input-open":"",e.inputProps.class],attrs:{name:"q",type:"text",autocomplete:"off",role:"combobox","aria-autocomplete":"list","aria-owns":"autosuggest__results","aria-activedescendant":e.isOpen&&null!==e.currentIndex?"autosuggest__results_item-"+e.currentIndex:"","aria-haspopup":e.isOpen?"true":"false","aria-expanded":e.isOpen?"true":"false"},domProps:{value:e.searchInput},on:{keydown:e.handleKeyStroke,click:e.onClick,input:function(t){t.target.composing||(e.searchInput=t.target.value)}}},"input",e.inputProps,!1)),e._v(" "),n("div",{class:e.component_attr_class_autosuggest__results_container},[e.getSize()>0&&!e.loading?n("div",{class:e.component_attr_class_autosuggest__results,attrs:{"aria-labelledby":e.component_attr_id_autosuggest}},e._l(this.computedSections,function(t,i){return n(t.type,{key:e.getSectionRef(i),ref:e.getSectionRef(i),refInFor:!0,tag:"component",attrs:{normalizeItemFunction:e.normalizeItem,renderSuggestion:e.renderSuggestion,section:t,updateCurrentIndex:e.updateCurrentIndex,searchInput:e.searchInput}})})):e._e()])])},staticRenderFns:[],name:"autosuggest",components:{DefaultSection:u},props:{inputProps:{type:Object,required:!0,default:function(){return{id:{type:String,default:"autosuggest__input"},onInputChange:{type:Function,required:!0},initialValue:{type:String,required:!1},onClick:{type:Function,required:!1}}}},limit:{type:Number,required:!1,default:1/0},suggestions:{type:Array,required:!0,default:[]},renderSuggestion:{type:Function,required:!1,default:function(e){return e.item}},getSuggestionValue:{type:Function,required:!1,default:function(e){var t=e.item;return"object"==typeof t&&t.hasOwnProperty("name")?t.name:t}},shouldRenderSuggestions:{type:Function,required:!1,default:function(){return!0}},sectionConfigs:{type:Object,required:!1,default:function(){return{default:{onSelected:null}}}},onSelected:{type:Function,required:!1,default:null}},data:function(){return{component_attr_id_autosuggest:"autosuggest",component_attr_class_autosuggest__results_container:"autosuggest__results-container",component_attr_class_autosuggest__results:"autosuggest__results",searchInput:"",searchInputOriginal:null,currentIndex:null,currentItem:null,loading:!1,didSelectFromOptions:!1,computedSections:[],computedSize:0,internal_inputProps:{},defaultInputProps:{initialValue:"",onClick:function(){}},defaultSectionConfig:{name:"default",type:"default-section"}}},computed:{isOpen:function(){return this.getSize()>0&&this.shouldRenderSuggestions()&&!this.loading}},methods:{_onSelected:function(){this.currentItem&&this.sectionConfigs[this.currentItem.name]&&this.sectionConfigs[this.currentItem.name].onSelected?this.sectionConfigs[this.currentItem.name].onSelected(this.currentItem,this.searchInputOriginal):this.sectionConfigs.default.onSelected?this.sectionConfigs.default.onSelected(null,this.searchInputOriginal):this.onSelected&&this.onSelected(this.currentItem)},getSectionRef:function(e){return"computed_section_"+e},getSize:function(){return this.computedSize},getItemByIndex:function(e){var t=this,n=!1;if(null===e)return n;for(var i=0;i<this.computedSections.length;i++)if(e>=t.computedSections[i].start_index&&e<=t.computedSections[i].end_index){var s=e-t.computedSections[i].start_index,u=t.$refs["computed_section_"+i][0];if(u){n=t.normalizeItem(t.computedSections[i].name,t.computedSections[i].type,u.getLabelByIndex(s),u.getItemByIndex(s));break}}return n},handleKeyStroke:function(e){var t=this,n=e.keyCode;if(!([16,9,18,91,93].indexOf(n)>-1))switch(this.loading=!1,this.didSelectFromOptions=!1,n){case 40:case 38:if(e.preventDefault(),this.isOpen){if(38===n&&null===this.currentIndex)break;var i=40===n?1:-1,s=parseInt(this.currentIndex)+i;this.setCurrentIndex(s,this.getSize(),i),this.didSelectFromOptions=!0,this.getSize()>0&&this.currentIndex>=0?(this.setChangeItem(this.getItemByIndex(this.currentIndex)),this.didSelectFromOptions=!0):-1==this.currentIndex&&(this.currentIndex=null,this.searchInput=this.searchInputOriginal,e.preventDefault())}break;case 13:if(e.preventDefault(),229===n)break;this.$nextTick(function(){t.getSize()>0&&t.currentIndex>=0&&(t.setChangeItem(t.getItemByIndex(t.currentIndex),!0),t.didSelectFromOptions=!0),t.loading=!0,t.$nextTick(function(){t._onSelected(t.didSelectFromOptions)})});break;case 27:this.isOpen&&(this.loading=!0,this.currentIndex=null,this.searchInput=this.searchInputOriginal,e.preventDefault())}},setChangeItem:function(e,t){void 0===t&&(t=!1),null===this.currentIndex?this.currentItem=null:e&&(this.searchInput=this.getSuggestionValue(e),this.currentItem=e,t&&(this.searchInputOriginal=this.getSuggestionValue(e)),this.ensureItemVisible(e,this.currentIndex))},normalizeItem:function(e,t,n,i){return{name:e,type:t,label:n,item:i}},ensureItemVisible:function(e,t){var n=document.querySelector("."+this.component_attr_class_autosuggest__results);if(e&&(t||0===t)&&n){var i=document.querySelector("#autosuggest__results_item-"+t);if(i){var s=n.clientHeight,u=n.scrollTop,r=i.clientHeight,o=i.offsetTop;r+o>=u+s?n.scrollTo(0,r+o-s):o<u&&u>0&&n.scrollTo(0,o)}}},updateCurrentIndex:function(e){this.currentIndex=e},onDocumentMouseUp:function(e){var t=this;if(!s(this.$el,e.target)||"INPUT"!==e.target.tagName){if(null===this.currentIndex||!this.isOpen)return void(this.loading=this.shouldRenderSuggestions());this.loading=!0,this.didSelectFromOptions=!0,this.setChangeItem(this.getItemByIndex(this.currentIndex),!0),this.$nextTick(function(){t._onSelected(!0)})}},setCurrentIndex:function(e,t,s){void 0===t&&(t=-1);var u=e;null===this.currentIndex&&(u=0),this.currentIndex<0&&1===s&&(u=0),e>=t&&(u=0),this.currentIndex=u;var r=document.getElementById("autosuggest__results_item-"+this.currentIndex),o="autosuggest__results_item-highlighted";document.querySelector("."+o)&&i(document.querySelector("."+o),o),r&&n(r,o)},onClick:function(){var e=this;this.loading=!1,this.internal_inputProps.onClick(this.currentItem),this.$nextTick(function(){e.ensureItemVisible(e.currentItem,e.currentIndex)})}},mounted:function(){Object.assign(this.internal_inputProps,this.defaultInputProps,this.inputProps),Object.assign(this.sectionConfigs),document.addEventListener("mouseup",this.onDocumentMouseUp),this.searchInput=this.internal_inputProps.initialValue,this.loading=!0},watch:{searchInput:function(e){this.value=e,this.didSelectFromOptions||(this.searchInputOriginal=this.value,this.currentIndex=null,this.internal_inputProps.onInputChange(e))},suggestions:{immediate:!0,handler:function(){var e=this;this.computedSections=[],this.computedSize=0,this.suggestions.forEach(function(t){if(t.data){var n=t.name?t.name:e.defaultSectionConfig.name,i=e.sectionConfigs[n],s=i.type,u=i.limit,r=i.label;s=s||e.defaultSectionConfig.type,u=u||1/0,u=t.data.length<u?t.data.length:u,r=r||t.label;var o={name:n,label:r,type:s,limit:u,data:t.data,start_index:e.computedSize,end_index:e.computedSize+u-1};e.computedSections.push(o),e.computedSize+=u}},this)}}}},o={install:function(e){e.component("vue-autosuggest-default-section",u),e.component("vue-autosuggest",r)}};"undefined"!=typeof window&&window.Vue&&window.Vue.use(o),e.default=o,e.VueAutosuggest=r,e.DefaultSection=u,Object.defineProperty(e,"__esModule",{value:!0})});
